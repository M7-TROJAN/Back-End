
## 1️⃣ يعني إيه Callback / Webhook؟

* ال **Callback** = عملية استدعاء بيرجعلك فيها السيرفر بتاع بوابة الدفع بالنتيجة (نجح الدفع / فشل / ملغي).
* ال **Webhook** = طريقة (URL) انت بتجهزها في سيستمك → بوابة الدفع بتبعت عليها **Request (POST)** فيه تفاصيل العملية بعد ما العميل يخلص الدفع.

بمعنى: بدل ما تفضل تسأل البوابة كل شوية “هو العميل دفع ولا لسه؟” → هم بنفسهم يبعتولك إشعار (Notification) أول ما يحصل تغيير في حالة الدفع.

---

## 2️⃣ مثال واقعي

* محمود يطلب كتاب من موقعك.
* انت تعمل **Invoice** في Paymob أو PayTabs.
* محمود يدفع بكارت فيزا.
* البوابة تعمل اتنين:

  1. توري محمود رسالة “تم الدفع بنجاح ✅”.
  2. تبعتلك على **Webhook URL** اللي انت معرفه عندهم (زي: `https://yourdomain.com/api/payment/callback`) → JSON فيه:

     * ال `transaction_id`
     * ال `order_id`
     * ال `status` (paid, failed, pending)
     * ال `amount`

انت تاخد البيانات دي وتحدث الـDB عندك:

* لو **paid** → تغير حالة الطلب لـ "مدفوع".
* لو **failed** → تعمله cancel أو retry.

---

## 3️⃣ الفرق بين Callback و Redirect

* ال **Redirect URL**: بعد ما العميل يدفع، بيتحول لصفحة عندك (مثلاً `/payment/success`). ده بس عشان يوريه رسالة.
* ال **Webhook/Callback**: ده اللي عليه العُمدة → لأنه بيبعتلك من البوابة نفسها إشعار رسمي إن الفلوس اتدفعت. (ممكن العميل يقفل التاب أو النت يقطع، لكن الـWebhook هيجيلك برضه).

---

## 4️⃣ ا

 **إيه هو الـWebhook وليه مهم في الدفع الإلكتروني؟**
   – هو URL بيبعت عليه مزوّد الدفع تفاصيل العملية بعد ما تخلص، عشان أقدر أعمل update في السيستم بتاعي بشكل آلي. وهو مهم لأنه يضمن إن السيستم يسجل الدفع حتى لو العميل ما رجعش للـredirect page.

 **إزاي تأمّن الـWebhook؟**
   – أتحقق من التوقيع (signature أو HMAC) اللي بتبعت مع البيانات. كل بوابة بتديك secret key تستخدمه للتحقق إن الريكوست جاي فعلًا منهم مش من هاكر.

 **إيه اللي ممكن يحصل لو ما استخدمتش Webhook؟**
   – مش هتعرف حالة الدفع بدقة. ممكن يبقى العميل دفع لكن ما رجعش للصفحة → فتفتكر إنه ما دفعش.

---
