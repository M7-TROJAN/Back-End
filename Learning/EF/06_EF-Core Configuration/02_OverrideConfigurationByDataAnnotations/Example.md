# Overriding Configuration by Data Annotations in EF Core

This guide demonstrates how to override the default configuration in Entity Framework Core using Data Annotations. We'll use a simple database schema for a fake Twitter application, `FakeTwitterV1`, and configure it with Data Annotations.

## Prerequisites

- .NET SDK
- SQL Server
- `appsettings.json` file with the connection string
- Entity Framework Core packages (can be installed via NuGet)

## Project Structure

Ensure your project structure includes the following files:
- `Program.cs`
- `FakeTwitterV1Context.cs`
- `User.cs`
- `Tweet.cs`
- `Comment.cs`
- `appsettings.json`

## Step-by-Step Guide

### 1. `appsettings.json`

Create an `appsettings.json` file in the root of your project with the following content:

```json
{
  "ConnectionStrings": {
    "FakeTwitterV1": "Server=YourServer;Database=FakeTwitterV1;Integrated Security=True;"
  }
}
```

### 2. Entity Classes

The entity classes represent the tables in the database, configured using Data Annotations.

#### `User.cs`

```csharp
using System.ComponentModel.DataAnnotations.Schema;

namespace _02_OverrideConfigurationByDataAnnotations.Entities
{
    [Table("tblUsers")] // Specifies the table name in the database
    public class User
    {
        public int UserId { get; set; }
        public string Username { get; set; }

        override public string ToString()
        {
            return $"[{UserId}] - {Username}";
        }
    }
}
```

#### `Tweet.cs`

```csharp
using System.ComponentModel.DataAnnotations.Schema;

namespace _02_OverrideConfigurationByDataAnnotations.Entities
{
    [Table("tblTweets")] // Specifies the table name in the database
    public class Tweet
    {
        public int TweetId { get; set; }
        public int UserId { get; set; }
        public string TweetText { get; set; }
        public DateTime CreatedAt { get; set; }
    }
}
```

#### `Comment.cs`

```csharp
using System.ComponentModel.DataAnnotations;
using System.ComponentModel.DataAnnotations.Schema;

namespace _02_OverrideConfigurationByDataAnnotations.Entities
{
    [Table("tblComments")] // Specifies the table name in the database
    public class Comment
    {
        [Column("CommentId")] // Specifies the column name in the database
        [DatabaseGenerated(DatabaseGeneratedOption.Identity)] // Specifies that the value is generated by the database
        public int Id { get; set; }
        public int TweetId { get; set; }
        public int UserId { get; set; }
        public string CommentText { get; set; }
        public DateTime CreatedAt { get; set; }
    }
}
```

### 3. `FakeTwitterV1Context.cs`

The `FakeTwitterV1Context` class is configured to use `DbContextOptions` for its configuration.

```csharp
using _02_OverrideConfigurationByDataAnnotations.Entities;
using Microsoft.EntityFrameworkCore;
using Microsoft.Extensions.Configuration;

namespace _02_OverrideConfigurationByDataAnnotations.Data
{
    internal class FakeTwitterV1Context : DbContext
    {
        public DbSet<Tweet> Tweets { get; set; } // DbSet for Tweets table
        public DbSet<User> Users { get; set; } // DbSet for Users table
        public DbSet<Comment> Comments { get; set; } // DbSet for Comments table

        // if the dbset name is not the same as the table name in the database the exception will be thrown
        // (microsoft.data.sqlclient.SqlException "invalid object Name") 

        protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)
        {
            base.OnConfiguring(optionsBuilder);

            var config = new ConfigurationBuilder()
                .AddJsonFile("appsettings.json")
                .Build();

            var connectionString = config.GetConnectionString("FakeTwitterV1");

            optionsBuilder.UseSqlServer(connectionString);
        }
    }
}
```

### 4. Main Program

The main program demonstrates how to query the data from the `FakeTwitterV1` database using EF Core.

```csharp
using _02_OverrideConfigurationByDataAnnotations.Data;

namespace _02_OverrideConfigurationByDataAnnotations
{
    internal class Program
    {
        static void Main(string[] args)
        {
            using (var context = new FakeTwitterV1Context())
            {
                Console.WriteLine("\n_________ Users __________\n");
                foreach (var user in context.Users)
                {
                    Console.WriteLine(user);
                }

                Console.WriteLine("\n_________ Tweets __________\n");
                foreach (var tweet in context.Tweets)
                {
                    Console.WriteLine(tweet.TweetText);
                }

                Console.WriteLine("\n_________ Comments __________\n");
                foreach (var comment in context.Comments)
                {
                    Console.WriteLine(comment.CommentText);
                }
            }

            Console.ReadKey();
        }
    }
}
```

## Explanation of Key Points

1. **Specifying Table Name**:
    ```csharp
    [Table("tblUsers")]
    ```
    - The `[Table]` attribute is used to specify the table name in the database that corresponds to the entity class. This is particularly useful when the table name does not follow the default convention.

2. **Specifying Column Name and Generation**:
    ```csharp
    [Column("CommentId")]
    [DatabaseGenerated(DatabaseGeneratedOption.Identity)]
    ```
    - The `[Column]` attribute specifies the column name in the database. The `[DatabaseGenerated]` attribute specifies how the value is generated by the database, such as an identity column.

3. **Retrieving Connection String**:
    ```csharp
    var connectionString = config.GetConnectionString("FakeTwitterV1");
    ```
    - The connection string is retrieved from the configuration. This connection string is used to configure the `DbContext` to connect to the SQL Server database.

4. **Using the DbContext**:
    ```csharp
    using (var context = new FakeTwitterV1Context())
    {
        // Operations with DbContext
    } // The context is disposed here
    ```
    - The `DbContext` is used within a `using` block to ensure proper disposal. When the `using` block is exited, the `Dispose` method of the `DbContext` is called, releasing any resources it holds. Proper disposal of the `DbContext` is essential to avoid memory leaks and ensure that database connections are released back to the pool.

## Conclusion

This example demonstrates how to override the default configuration in Entity Framework Core using Data Annotations. By following these steps, you can customize the database schema and enforce validation rules directly in your entity classes, ensuring that your data model adheres to your business rules and database schema requirements.