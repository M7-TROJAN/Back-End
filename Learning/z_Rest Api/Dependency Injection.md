
#### **1. ูุจุฏุฃ ุนูุณ ุงูุชุจุนูุฉ (Dependency Inversion Principle)**

ูุนุชูุฏ **Dependency Injection** ุนูู ูุจุฏุฃ **ุนูุณ ุงูุชุจุนูุฉ (Dependency Inversion Principle - DIP)**ุ ููู ุฃุญุฏ ูุจุงุฏุฆ **SOLID** ูู ุงูุจุฑูุฌุฉ ุงููุงุฆููุฉ ุงูุชูุฌู **(OOP)**. ููุต ูุฐุง ุงููุจุฏุฃ ุนูู:

1. **ูุฌุจ ุฃูุง ุชุนุชูุฏ ุงููุญุฏุงุช ุนุงููุฉ ุงููุณุชูู (High-Level Modules) ุนูู ุงููุญุฏุงุช ููุฎูุถุฉ ุงููุณุชูู (Low-Level Modules)ุ ุจู ูุฌุจ ุฃู ุชุนุชูุฏุง ููุชุงููุง ุนูู ุงูุชุฌุฑูุฏ (Abstraction).**
2. **ูุฌุจ ุฃูุง ูุนุชูุฏ ุงูุชุฌุฑูุฏ (Abstraction) ุนูู ุงูุชูุงุตูู (Details)ุ ุจู ูุฌุจ ุฃู ุชุนุชูุฏ ุงูุชูุงุตูู ุนูู ุงูุชุฌุฑูุฏ.**

๐น **ุชูุณูุฑ ุงููุจุฏุฃ:**
ุจุฏูุงู ูู ุฃู ูุนุชูุฏ ุงูููุฏ ุจุดูู ูุจุงุดุฑ ุนูู ูุงุฆูุงุช ูุนููุฉุ ูุฅูู ูุนุชูุฏ ุนูู **ูุงุฌูุงุช (Interfaces) ุฃู ูุงุฆูุงุช ูุฌุฑุฏุฉ (Abstract Classes)**ุ ููุง ูุณูุญ ุจุงูุชุบููุฑ ุจุณูููุฉ ุฏูู ุงูุชุฃุซูุฑ ุนูู ุงูุฃุฌุฒุงุก ุงูุฃุฎุฑู ูู ุงูุชุทุจูู.

#### **2. ููู ูุชู ุชุทุจูู Dependency Injectionุ**

ุนูุฏ ุงุณุชุฎุฏุงู **Dependency Injection**ุ ูุชู ุงุณุชุจุฏุงู ุงูุชุจุนูุงุช ุงููุจุงุดุฑุฉ ุจูู ุงูููููุงุชุ ูุซู:

```csharp
public class BooksController
{
    private readonly BooksService _booksService;

    public BooksController()
    {
        _booksService = new BooksService(); // ูุดููุฉ: ูุนุชูุฏ ุนูู ูุงุฆู ูุญุฏุฏ
    }
}
```

๐น **ูุฐู ุงูุทุฑููุฉ ุชุณุจุจ ุชุฏุงุฎููุง ููููุง (Tight Coupling)ุ ููุง ูุฌุนู ุงูููุฏ ุฃูู ูุฑููุฉ ูุตุนุจ ุงูุงุฎุชุจุงุฑ.**

 **ุจุฏููุง ูู ุฐููุ ูููู ุงุณุชุฎุฏุงู DI ุนู ุทุฑูู ุชูุฑูุฑ ุงูุชุจุนูุงุช ุนุจุฑ ุงููุงุฌูุงุช:**

```csharp
public class BooksController
{
    private readonly IBooksService _booksService;

    public BooksController(IBooksService booksService)
    {
        _booksService = booksService; // ุงุณุชุฎุฏุงู ูุงุฌูุฉ ูุฌุนู ุงูููุฏ ุฃูุซุฑ ูุฑููุฉ
    }
}
```

ุจูุฐู ุงูุทุฑููุฉุ ูููููุง ุงุณุชุจุฏุงู `BooksService` ุจุฃู ุชูููุฐ ุขุฎุฑ ูุซู `FakeBooksService` ุฃุซูุงุก ุงูุงุฎุชุจุงุฑ ุฏูู ุชุบููุฑ ุงูููุฏ ุฏุงุฎู `BooksController`.

---

### **3. ุฃููุงุน Service Lifetime ูู Dependency Injection**

ูู **ASP.NET Core**ุ ุนูุฏ ุชุณุฌูู ุงูุฎุฏูุงุช ุฏุงุฎู **Container** ุงูุฎุงุต ุจู Dependency Injectionุ ูููู ุชุญุฏูุฏ ููุน "ุนูุฑ ุงูุฎุฏูุฉ" **(Service Lifetime)**ุ ูููุงู ุซูุงุซ ุฃููุงุน ุฑุฆูุณูุฉ:

| **ุงูููุน**     | **ุงููุตู**                                                                                  |
| ------------- | ------------------------------------------------------------------------------------------ |
| **Transient** | ูุชู ุฅูุดุงุก ูุงุฆู ุฌุฏูุฏ ูู ูู ูุฑุฉ ูุชู ูููุง ุทูุจู.                                               |
| **Scoped**    | ูุชู ุฅูุดุงุก ูุงุฆู ูุงุญุฏ ููุท ููู **ุทูุจ (Request)** ููุจ ูุงุญุฏุ ูููุนุงุฏ ุงุณุชุฎุฏุงูู ุฏุงุฎู ููุณ ุงูุทูุจ.    |
| **Singleton** | ูุชู ุฅูุดุงุก ูุงุฆู ูุงุญุฏ ููุท ุทูุงู ูุชุฑุฉ ุชุดุบูู ุงูุชุทุจููุ ูููุณุชุฎุฏู ูู ุฌููุน ุงูุฃูุงูู ุงูุชู ุชุญุชุงุฌ ุฅููู. |

---

#### **4. ุงููุฑู ุจูู Service Lifetime ุงูุซูุงุซุฉ ูู ASP.NET Core**

๐น **Transient:**

* ูุชู ุฅูุดุงุก ูุงุฆู ุฌุฏูุฏ **ูู ูู ูุฑุฉ** ูุชู ูููุง ุงุณุชุฏุนุงุก ุงูุฎุฏูุฉ.
* ูููุถู ุงุณุชุฎุฏุงูู ูุน ุงูุฎุฏูุงุช ุงูุชู ูุง ุชุญุชุงุฌ ุฅูู ูุดุงุฑูุฉ ุงูุญุงูุฉ ุจูู ุงูุทูุจุงุช.

 **ูุซุงู:**

```csharp
services.AddTransient<IBooksService, BooksService>();
```

---

๐น **Scoped:**

* ูุชู ุฅูุดุงุก ูุงุฆู ูุงุญุฏ ููุท ููู **ุทูุจ (Request)**.
* ูุซุงูู ุนูุฏ ุงูุชุนุงูู ูุน **ูุงุนุฏุฉ ุงูุจูุงูุงุช**ุ ุญูุซ ูุณุงุนุฏ ูู ุงุณุชุฎุฏุงู ููุณ ุงููุงุฆู ุฏุงุฎู ุงูุทูุจ.

 **ูุซุงู:**

```csharp
services.AddScoped<IBooksService, BooksService>();
```

---

 **Singleton:**

* ูุชู ุฅูุดุงุก ูุงุฆู ูุงุญุฏ ููุท **ูุฌููุน ุงูุทูุจุงุช** ููุณุชูุฑ ุทูุงู ูุชุฑุฉ ุชุดุบูู ุงูุชุทุจูู.
* ููุงุณุจ ูุงุณุชุฎุฏุงู ุงููุงุฆูุงุช ุงูุชู ุชุญุชุงุฌ ุฅูู **ุญุงูุฉ ูุดุชุฑูุฉ** ูุซู **ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช (Cache)ุ ุฎุฏูุงุช ุงูุชุณุฌูู (Logging)**.

 **ูุซุงู:**

```csharp
services.AddSingleton<IBooksService, BooksService>();
```

---

### **5. ูุชู ูุณุชุฎุฏู ูู ููุนุ**

 **Transient:**

* ุฅุฐุง ููุช ุจุญุงุฌุฉ ุฅูู ูุงุฆู ุฌุฏูุฏ ูู ูู ูุฑุฉ ูุชู ุงุณุชุฏุนุงุก ุงูุฎุฏูุฉ.
* ููุงุณุจ ููุฎุฏูุงุช ุงูุฎูููุฉ **(Lightweight Services)** ุงูุชู ูุง ุชุนุชูุฏ ุนูู ุชุฎุฒูู ุจูุงูุงุช ุทูููุฉ ุงูุฃูุฏ.

 **Scoped:**

* ุฅุฐุง ููุช ุชุญุชุงุฌ ุฅูู **ุฅุนุงุฏุฉ ุงุณุชุฎุฏุงู ููุณ ุงููุงุฆู ุฏุงุฎู ููุณ ุงูุทูุจ ููุท**.
* ูุซุงูู ูุฎุฏูุงุช ุงูุชุนุงูู ูุน **ูุงุนุฏุฉ ุงูุจูุงูุงุช**.

 **Singleton:**

* ุนูุฏูุง ุชุญุชุงุฌ ุฅูู **ูุงุฆู ูุดุชุฑู ุนุจุฑ ุงูุชุทุจูู ุจุงููุงูู**.
* ููุงุณุจ **ูููุงุด (Caching)ุ ุงูู Loggingุ ูุฅุฏุงุฑุฉ ุงูุฅุนุฏุงุฏุงุช (Configurations).**

---

### **6. ุชุทุจูู ุนููู ูู ASP.NET Core**

#### **ุฎุทูุงุช ุชุณุฌูู ูุงุณุชุฎุฏุงู Dependency Injection ูู ASP.NET Core**

 **ุฅุถุงูุฉ ุงูุฎุฏูุงุช ุฏุงุฎู `Program.cs`**:

```csharp
var builder = WebApplication.CreateBuilder(args);

builder.Services.AddScoped<IBooksService, BooksService>();

var app = builder.Build();
```

 **ุงุณุชุฎุฏุงู ุงูุฎุฏูุฉ ุฏุงุฎู `BooksController`**:

```csharp
[ApiController]
[Route("[controller]")]
public class BooksController : ControllerBase
{
    private readonly IBooksService _booksService;

    public BooksController(IBooksService booksService)
    {
        _booksService = booksService;
    }

    [HttpGet]
    public IActionResult GetBooks()
    {
        var books = _booksService.GetAllBooks();
        return Ok(books);
    }
}
```

---

### **7. ุฎูุงุตุฉ**

* ุงู **Dependency Injection** ูุณูุญ ุจูุตู ุงูุชุจุนูุงุช ุจูู ุงูููููุงุชุ ููุง ูุฌุนู ุงูููุฏ **ุฃูุซุฑ ูุฑููุฉ ููุงุจููุฉ ููุงุฎุชุจุงุฑ**.
* ูุนุชูุฏ ุนูู ูุจุฏุฃ **ุนูุณ ุงูุชุจุนูุฉ (DIP)** ุงูุฐู ููุถู ุงูุงุนุชูุงุฏ ุนูู **ุงููุงุฌูุงุช** ุจุฏูุงู ูู ุงููุงุฆูุงุช ุงููุญุฏุฏุฉ.
* ููุงู **ุซูุงุซุฉ ุฃููุงุน ูู Service Lifetime**:

  * ุงู **Transient:** ูุงุฆู ุฌุฏูุฏ ูู ูู ูุฑุฉ.
  * ุงู **Scoped:** ูุงุฆู ูุงุญุฏ ููู ุทูุจ.
  * ุงู **Singleton:** ูุงุฆู ูุงุญุฏ ุทูุงู ูุชุฑุฉ ุชุดุบูู ุงูุชุทุจูู.
* ุงู **ASP.NET Core** ูุญุชูู ุนูู **Container ูุฏูุฌ** ูุฅุฏุงุฑุฉ ุงูุชุจุนูุงุช ุจุณูููุฉ.


---



## ุงููุฑู ุงูุนููู ุจูู Transient / Scoped / Singleton ูุด ุจุณ ูู "ุงูุนููุฑ"ุ ููู ููุงู ูู **ุณููู ุงููุงุฆู** ูุณููุงุฑูููุงุช ุงูู Web

---

### ุงู Transient:  ูุนูู ูู ูุฑุฉ ูุณุฎุฉ ุฌุฏูุฏุฉ

* ุจูุชู ุฅูุดุงุก **instance ุฌุฏูุฏ ูู ูู ูุฑุฉ** ูุทูุจ ููู ุงูู Container ุงูุฎุฏูุฉ.
* ูุนูู ูู Injectุช `IBookService` ูู 3 ุฃูุงูู ุฏุงุฎู ููุณ ุงูู Controllerุ ูุชุงุฎุฏ 3 ูุณุฎ ูุฎุชููุฉ.

 **ูุซุงูู ูู:**

* ุงูุฎุฏูุงุช ุงูุฎูููุฉ (Lightweight)ุ ุงููู ูุด ุจุชุฎุฒู state.
* ุงูุฎุฏูุงุช ุงูุญุณุงุจูุฉ (stateless operations) ุฒู `ICalculatorService`.
* `ValidationService`, `EmailTemplateFormatter`.

 **ูุณุงูุฆู:**

* ูููู ูุณุชููู ููุงุฑุฏ ุฃูุชุฑ ูุฃู ูู ูุฑุฉ ุจูุนูู new.
* ูู ููู dependency ุฏุงุฎูู (ูุซูุงู Scoped)ุ ูุญุตู ูุดุงูู ูู Injectุชู ุจุดูู ูุจุงุดุฑ.

---

###  ุงู Scoped: ูุนูู ูุณุฎุฉ ูุงุญุฏุฉ ููู Request

* ุจูุนูู instance ุฌุฏูุฏ **ููู HTTP Request**.
* ุฏุงุฎู ููุณ ุงูู Requestุ ูู ุงููู ูุทูุจ ุงูุฎุฏูุฉ ููุงุฎุฏ ููุณ ุงูู instance.

**ูุซุงูู ูู:**

* ุงูุชุนุงูู ูุน ูุงุนุฏุฉ ุงูุจูุงูุงุช ุจุงุณุชุฎุฏุงู `DbContext`.
* ุฎุฏูุงุช ุงูู Business logic ุงููู ุจุชุญุชุงุฌ ุชุดุงุฑู ุจูุงูุงุช ุจูู ุฃุฌุฒุงุก ุงูู Request.
* `IBooksService`ุ `ICartService`.

 ูู ุงุณุชุฎุฏูุชู ูู Singletonุ ูุญุตู **ุฎุทุฃ ุฎุทูุฑ**:

> `Cannot consume scoped service from singleton`

---

### ุงู  Singleton: ูุณุฎุฉ ูุงุญุฏุฉ ููุท ุทูู ููุช ุชุดุบูู ุงูุชุทุจูู

* ุจููุดุฆ instance **ูุฑุฉ ูุงุญุฏุฉ ุจุณ ุนูุฏ ุฃูู ุงุณุชุฎุฏุงู**.
* ูู ุงูุฃูุงูู ุงููู ุชุทูุจูุง ูุชุงุฎุฏ ููุณ ุงููุณุฎุฉ.

 **ูุซุงูู ูู:**

* ุงููุงุด `ICacheService`.
* ุชุณุฌูู ุงูุฏุฎูู `ILoggerService`.
* ุงูุชุญููู ุงููุณุจู ููุฅุนุฏุงุฏุงุช `IAppConfigService`.

โ ุงูุชุจู:

* ููููุน ุชุถูู ููู Scoped Services.
* ููููุนุด ุชุณุชุฎุฏูู ูู ููู state ุจูุชุบูุฑ ููู ููุฒุฑ.

---

##  ูุซุงู ุญู ุฏุงุฎู ASP.NET Core Request:

ููุชุฑุถ ุนูุฏูุง:

```csharp
services.AddScoped<IUserService, UserService>();
services.AddSingleton<ILoggerService, MyLogger>();
```

ูู `UserService` ูุญุชุงุฌ `ILoggerService`ุ ุฏู ุชูุงู.

ููู ูู ุงูุนูุณุ ูุนูู:

```csharp
public class MyLogger : ILoggerService
{
    public MyLogger(IUserService userService) { } // โ Error
}
```

ุฏู **ูุณุฑ ูุงุถุญ ูููุงุนุฏ ุงูู Lifetime**:

* ุงู Singleton ูุญุชุงุฌ Scoped โ ูุด ูุณููุญ.
* ูููุ ูุฃู Singleton ุจูุนูุด ููุฃุจุฏุ ููู Scoped ุจููุชูู ูุน ูู Request.

---

##  ููุฎุต ุงูุนูุงูุฉ ุจูููู:

| Injected Into | Transient | Scoped | Singleton |
| ------------- | --------- | ------ | --------- |
| Transient     | โ         | โ      | โ         |
| Scoped        | โ         | โ      | โ         |
| Singleton     | โ         | โ      | โ         |

---

##  ุณููุงุฑูููุงุช ูุงูุนูุฉ ุชุณุงุนุฏู ุชูุฑุฑ:

| ุงูุญุงูุฉ                           | ุงูููุน ุงูุฃูุณุจ | ุงูุณุจุจ                                 |
| -------------------------------- | ------------ | ------------------------------------- |
| ุญุณุงุจ ูุงุชุฌ ุฑูุงุถู ุฃู ูุนุงูุฌุฉ ูุคูุชุฉ  | Transient    | ูุง ูุญุชุงุฌ ุญูุธ ุงูุญุงูุฉ                   |
| ุฅุฏุงุฑุฉ ูุณุชุฎุฏู ุญุงูู ูู Request     | Scoped       | ูู Request ููู ูุณุชุฎุฏู ุฎุงุต             |
| ุฎุฏูุฉ ุฅุนุฏุงุฏุงุช ุงูุชุทุจูู ุงูุนุงูุฉ      | Singleton    | ููุณ ุงูุฅุนุฏุงุฏุงุช ููู ุงูุชุทุจูู             |
| ุงููุตูู ูู DB ุฃู Entity Framework | Scoped       | ุนุดุงู ุชุฑุจุท ูู ุงูุนูููุงุช ุจููุณ ุงูุณูุงู     |
| ุชุณุฌูู ุงูุฃุญุฏุงุซ / Logging          | Singleton    | ุฃุฏุงุก ุฃุนููุ ููุง ูุญุชุงุฌ ููู Request ูุณุฎุฉ |

---

##  ููุงุญุธุงุช ูููุฉ ุฌุฏูุง:

* ูู ูุชุจุช ููุงุณ ููู `Guid` ุฏุงุฎู Constructor ุนูุดุงู ุชุฑุงูุจ ุณููู ุงูู Lifetime:

```csharp
public class BookService : IBookService
{
    private readonly Guid _id = Guid.NewGuid();
    public Guid GetId() => _id;
}
```

* ูุงุณุชุฎุฏูุช `IBookService` ูู `Controller`ุ ูุดุบูุช ุงูุชุทุจูู:

  * ูู Transient: ูู ูุฑุฉ ID ูุฎุชูู
  * ูู Scoped: ููุณ ID ุฏุงุฎู ููุณ ุงูู Request
  * ูู Singleton: ููุณ ID ุทูู ุนูุฑ ุงูุชุทุจูู

---

##  ุงุฒุงู ุชููุฑ ูุชูุฑุฑ ุชุณุชุฎุฏู ุฃููู Lifetimeุ

1. **ูู ุงูุฎุฏูุฉ ูููุง ุญุงูุฉ ุซุงุจุชุฉุ** โ Singleton
2. **ูู ุงูุฎุฏูุฉ ูููุง ุจูุงูุงุช ุชุชุบูุฑ ูู ูู Requestุ** โ Scoped
3. **ูู ุงูุฎุฏูุฉ ุฎูููุฉุ ูุง ุชุญุชุงุฌ ุฃู Stateุ** โ Transient
4. **ูู Injected dependencies ูููุง Scopedุ** โ ูุงุฒู ุชุจุนุฏ ุนู Singleton
5. **ูู ูุญุชุงุฌ ุชุดุงุฑู ุงูุจูุงูุงุช ุจูู ุฃุฌุฒุงุก ุงูู Requestุ** โ Scoped
6. **ูู ุงูุฃุฏุงุก ููู ุฌุฏูุง ูุงูุชูููุฉ ุนุงููุฉุ** โ Singleton

---
