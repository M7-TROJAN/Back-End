
# **Refresh Tokens**

## **ุฃูููุง: ูู ูู ุถุฑูุฑูุฉุ**

ุฎูููุง ูููู ูุงุถุญูู ูู ุงูุจุฏุงูุฉ:
**Refresh Tokens (Not Mandatory)**.

ูุนูู ุฅูุช ูููู ุชุจูู ูุธุงู Login ูุงูู ุจุงุณุชุฎุฏุงู JWT ุจุณุ ูู ุบูุฑ ูุง ุชุถูู ุฃู ุญุงุฌุฉ ุงุณููุง "Refresh Token".
ููู ุงูุชุทุจูู ุจุณูุท ุฃู ุบูุฑ ุญุณุงุณ ุฃููููุงุ ููููุด ุญุงุฌุฉ ุชุชุทูุจ ุฅู ุงูููุฒุฑ ููุถู logged in ููุชุฑุฉ ุทูููุฉุ ููููู ุชููู ุนุงุฏู ูู ุบูุฑูุง.

ููู...

ูู ุจุชุจูู **ุชุทุจูู ุญูููู ุจูุณุชุฎุฏูู ูุงุณ ูุนูููุง**ุ ูุจููุถููุง logged in ุจุงูุณุงุนุงุช ุฃู ุงูุฃูุงู ุฃู ุงูุดููุฑ โ ุฒู Gmail, Facebook, Netflix โ ูุจูู ุงู Refresh Tokens **ูุด ูุฌุฑุฏ ุฅุถุงูุฉ ุงุฎุชูุงุฑูุฉุ ุจู ุถุฑูุฑูุฉ ุฌุฏูุง**.

---

## **ุชุนุงูู ูุจุฏุฃ ุจุงููุดููุฉ ุงูุฃุณุงุณูุฉ ูู JWT**

ูู JWT Token ุจูุญุชูู ุนูู:

* ุจูุงูุงุช ุงูููุฒุฑ (Claims)
* ุชูููุน ุฑููู (Signature)
* ูุฏุฉ ุตูุงุญูุฉ (`exp`)

### ูุนูู ุฅูู ุตูุงุญูุฉ (Expiration)ุ

ูุนูู ููู ููุช ูุนูู ุงูุชููู ููู ูููู ุตุงูุญ **Valid**ุ ูุจุนุฏ ูุฏู ุฎูุงุต ูุนุชุจุฑ **expired**.
ุงูู JWT ูุด ุจูุชุญุฏุซ ุชููุงุฆููุงุ ููููุด ุทุฑููุฉ ููุฏ ุตูุงุญูุชู ุจุนุฏ ูุง ูุฎูุต.

> ูุฏู ุญุงุฌุฉ ูููุณุฉ ุฃููููุง: ุงูู Token ูู ุนูุฑ ูุญุฏูุฏุ ูุญุชู ูู ุงุชุณุฑูุจุ ููุดุชุบูุด ููุฃุจุฏ.

### ุทูุจ... ุจุนุฏ ูุง ูุฎูุตุ

ูู ุงูู Token ุฎูุตุ ูุฌุฑุจุช ุชุจุนุชู ูู ุฃู request ูุญูู ุจุงูุณูุฑูุฑุ ููุฌููู:

```http
401 Unauthorized
```

ูุนูู ุงูุณูุฑูุฑ ุฑูุถ ุงูุทูุจ ูุฃู ุงูู access token ููุชูู.

---

## **ุทูุจ ููู ุฏู ูุดููุฉุ**

ุงูููุฒุฑ ูุด ููููู ูุนูู ุฅูู JWT ููุง Expiry ููุง 401.
ูู ุงููู ูู ุดุงููู ุฅูู ูุงู ุดุบุงูุ ููุฌุฃุฉ ุงูุชุทุจูู ุจููููู:

> "You're logged out"
> "Please login again"

ูุฏู ุดุนูุฑ ุณูุฆ ุฌุฏูุงุ ูุจูุฃุซุฑ ุนูู ุงูู UX (User Experience) ุจุดูู ุณูุจู.
ูุญุฏุด ุนุงูุฒ ูู ุดููุฉ ููุชุจ ุงูุฅูููู ูุงูุจุงุณูุฑุฏ ุชุงูู!

---

## **ุงูุญู: ูุถูู Refresh Token**

### ุฅูู ุงููู ุจูุญุตู ุจูู ูู ุงูุชุทุจููุงุช ุงููุญุชุฑูุฉุ

ุฃูู ูุง ุงูููุฒุฑ ูุนูู **Login**:

 ุงูุณูุฑูุฑ ุจูุจุนุชูู **ุงุชููู ุชููู**:

1- ุงู JWT Access Token	

* ุตุบูุฑ ูุฎููู ูุณุฑูุน - ูุณุชุฎุฏู ูู ูู ุงูุฑูููุณุชุงุช ุงููุญููุฉ

2- ุงู Refresh Token	

*  ุทููู ุงููุฏู โ ููุณุชุฎุฏู ุจุณ ูุชุฌุฏูุฏ (ุชุญุฏูุซ) ุงูู JWT ุจุนุฏ ูุง ูุฎูุต

---

## **ูุฏุฉ ุงูุตูุงุญูุฉ ุงููุฎุชููุฉ**

| ููุน ุงูุชููู    | ูุฏุฉ ุงูุตูุงุญูุฉ ุงููููุฐุฌูุฉ         |
| ------------- | ------------------------------ |
| Access Token  | ูู 5 ุฏูุงูู ูู 1 ุณุงุนุฉ (ูุตูุฑุฉ)   |
| Refresh Token | ูู ุฃูุงู ูุฃุณุงุจูุน ุฃู ุดููุฑ (ุฃุทูู) |

---

## **ุทูุจ ุงูู Client ุจูุนูู ุฅููุ**

### ุงูุณููุงุฑูู ุงูุทุจูุนู:

1. ุงูููุฒุฑ ุนูู login โ ุงูุณูุฑูุฑ ุฑุฌุนูู access token + refresh token.
2. ุงูุชุทุจูู ุจูุณุชุฎุฏู ุงูู access token ูุน ูู API request.
3. ุจุนุฏ ูุชุฑุฉุ ุงูู access token ุฎูุต (expired).
4. ุจุฏู ูุง ูุธูุฑ ููู ููุฒุฑ ุฑุณุงูุฉ "ุงุนูู login ุชุงูู"ุ ุงูุชุทุจูู ูุนูู ุงูุขุชู:

    **ูุจุนุช refresh token ููุณูุฑูุฑ ููุทูุจ access token ุฌุฏูุฏ.**
    ุงูุณูุฑูุฑ ููููุฏ JWT ุฌุฏูุฏ (ูู ุงูุฑููุฑุด ุชููู ุณููู) ููุฑุฌุนู ุงูุชุทุจูู.
    ุงูุชุทุจูู ูุณุชุฎุฏู ุงูุชููู ุงูุฌุฏูุฏโฆ ูุงูููุฒุฑ ูุด ูุงุฎุฏ ุจุงูู ุฅู ุญุตู ุฃู ุญุงุฌุฉ.


---

## ููุญูุธุฉ ูู ุณููุงุฑูู ุงู Tokens ุ ููู ุทุฑููู ููููู ูุงุฒู ููุฑู ุจูููู:

* **ุงูููุฒุฑ (User)**: ูู ุงูุดุฎุต ุงูุญูููู ุงููู ุจูุณุชุฎุฏู ุงูุชุทุจูู โ ุฒูู ููุง ุชูุชุญ Gmail ุฃู Facebook. 

* **ุงูุนููู ุงู ุงูุชุทุจูู (Client App)**: ุงูููุฏ ุงููู ุจูุดุชุบู ุนูุฏ ุงููุณุชุฎุฏู ูุจูุชูุงุตู ูุน ุงูู API โ ุณูุงุก ูููุน ููุจ (React, Angular) ุฃู ููุจุงูู (Android, iOS) ุฃู ุญุชู Postman.

---

## **ุทุจ ูุนูู ุงูุชููู ุจูุชุฌุฏุฏ ุฅูู ูุง ูุง ููุงูุฉุ**

ูุง ุทุจุนูุง.

ูู Refresh Token ูู ุตูุงุญูุฉ ููุงู.
ูููุง ุชูุชูู ุตูุงุญูุฉ ุงูู refresh token ุฃู ูุชู ุฅูุบุงุคู ูุฃู ุณุจุจ:

 ุงูุณูุฑูุฑ ูุฑูุถ ุทูุจ ุงูุชุฌุฏูุฏ.
 ุงูุนููู (ุงูุชุทุจูู) ูุถุทุฑ ูุนุฑุถ ููู ููุฒุฑ ุฅูู ูุนูู Login ุชุงูู.

---

## **ุทูุจ ููู ููุฎููุด ุงูู JWT ุตุงูุญ ููุชุฑุฉ ุทูููุฉ ูู ุงูุฃููุ**

ุณุคุงู ูููุ ูุงูุฅุฌุงุจุฉ ุนููู ุฃูููุฉ ุฌุฏูุง:

| ุงูุฎูุงุฑ     | ุงูุชููู ุตุงูุญ ููุฏุฉ ุทูููุฉ            | ุงูุชููู + ุฑููุฑุด ุชููู                                 |
| ---------- | --------------------------------- | --------------------------------------------------- |
| ๐ ูุฎุงุทุฑู  | ูู ุงุชุณุฑูุจ โ ุตูุงุญูุฉ ุทูููุฉ ุฌุฏูุง     | ุงูุฑูุณู ูููู ูุฃูู ุจูุฎูุต ุจุณุฑุนุฉ                        |
| ๐ ุงูุชุญุฏูุซ | ุตุนุจ ุชูุบู ุชูููุงุช                   | ูููู ุชูุบู ุงูุฑููุฑุด ุชููู ุจุณูููุฉ                       |
| ๐ ุงูุณูุทุฑุฉ | ูููุด ุชุญูู ูู ุงูุชูููุงุช ุจุนุฏ ุฅุตุฏุงุฑูุง | ุนูุฏู DB ูููุง ูู ุงูู Refresh Tokens ูุชูุฏุฑ ุชุชุญูู ูููุง |

> ุจุงุฎุชุตุงุฑ: ุงูุชูููุงุช ุงูุทูููุฉ = ุฑุงุญุฉ ูููุณุชุฎุฏู ููู ุฎุทุฑ ุฃููู
> Refresh Tokens = ุงูุฑุงุญุฉ + ุงูุฃูุงู

---

## ุงูุฎูุงุตุฉ ุงููุธุฑูุฉ

| โ ุงูููุฑุฉ ุงูุฃุณุงุณูุฉ | ููุง ุงูู JWT Token ูุฎูุตุ ุจุฏู ูุง ุชุทูุจ ูู ุงููุณุชุฎุฏู ูุนูู login ุชุงููุ ุชุณุชุฎุฏู ุงูู Refresh Token ุนูุดุงู ุชููุฏ ูุงุญุฏ ุฌุฏูุฏ ุจุดูู ุชููุงุฆู |
| ----------------- | -------------------------------------------------------------------------------------------------------------------------- |
| โ ุงูููุฒุฉ ุงูุฃูููุฉ  | ุงูุฑููุฑุด ุชููู ุจูุชุฎุฒู ุบุงูุจูุง ูู ููุงู ุขูู (ุฒู HttpOnly Cookie) โ ููููู ุชูุบูู ููุช ูุง ุชุญุจ                                       |
| โ ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู  | ุงููุณุชุฎุฏู ููุถู logged in ุจุฏูู ูุง ูุญุณ ุจุฃู ุญุงุฌุฉ                                                                               |
| โ ุงูุชุญูู          | ุงูุณูุฑูุฑ ุจููุฏุฑ ูุชุญูู ูู ุงูุฌูุณุงุช ูุงูุชูููุงุช ุจููุชูู ุงูุณูููุฉ                                                                    |

---

## ุฎุทูุงุช ุนูู Refresh Token System (ูุฌูุฒูุง ููู Implementation ูุงุญููุง)

1. โ ุนูุฏ ุชุณุฌูู ุงูุฏุฎูู:

   * ุงูุณูุฑูุฑ ููููุฏ Access Token + Refresh Token
   * ูุฎุฒู ุงูุฑููุฑุด ุชููู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช + ูุฑุฌุนู ููุนููู

2. ๐ ุนูุฏ ุงูุชูุงุก ุตูุงุญูุฉ ุงูู Access Token:

   * ุงูุนููู ูุฑุณู ุงูุฑููุฑุด ุชููู ูู API ูุฎุตุตุฉ (ูุซูุงู `/auth/refresh`)
   * ุงูุณูุฑูุฑ ูุชุญูู ููู:

     * ูู ุตุงูุญ โ ููููุฏ ุชููู ุฌุฏูุฏ ููุฑุฌุนู
     * ูู ุบูุฑ ุตุงูุญ โ ูุฑุฌุน `401` ููุทูุจ ุชุณุฌูู ุงูุฏุฎูู

3. โ ุนูุฏ ุชุณุฌูู ุงูุฎุฑูุฌ ุฃู ุฅูุบุงุก ุงูุฌูุณุฉ:

   * ุงูุณูุฑูุฑ ูุญุฐู ุฃู ูุจุทู ุงูุฑููุฑุด ุชููู
   * ุนุดุงู ูุงูุชุณุชุฎุฏูุด ุจุนุฏ ูุฏู

---

## ๐ฆ ููู ุจูุฎุฒู ุงูุฑููุฑุด ุชูููุ

* โ **ูุด ุฌูู ุงูู JWT ููุณู**
* โ ุบุงูุจูุง ูู:

  * ูุงุนุฏุฉ ุงูุจูุงูุงุช (ูุน UserId ู ExpirationDate)
  * LocalStorage ุฃู HttpOnly Cookie ุนูู ุงูุนููู

---

## ๐ฏ ุฅูุชู ุชุณุชุฎุฏู Refresh Tokens ูุนููุงุ

| ุงูุญุงูุฉ                                              | ูุณุชุฎุฏู Refresh Tokenุ |
| --------------------------------------------------- | --------------------- |
| Web App ุจุชุญุชุงุฌ ุตูุงุญูุฉ ุทูููุฉ                         | โ ุฃููู                |
| Mobile App ููู ุฃูููุงูู ููุฏ                          | โ ุฃููู                |
| API ูููุงููุฑูุณูุฑููุณ ูููุง ุชูุงุนู ูุซูุฑ                  | โ ุฃููู                |
| Dashboard ุฏุงุฎูู ุจูุชู ุชุณุฌูู ุงูุฏุฎูู ููู ูุฑุฉ ูุงุญุฏุฉ ููุท | โ ูุด ูุงุฒู             |
| Application ุนูุฑ ุงูุฌูุณุฉ ููู ูููู ุฌุฏูุง                | โ ุบุงูุจูุง ูุด ูุญุชุงุฌ     |

---

## ๐จโ๐ป ูููู ุจุนุฏ ูุฏู ุจุงูู Implementationุ

ูู ุชูุงู ูุฏู ุนูู ุงููุธุฑู ููููููุ ููุจุฏุฃ ูุฌูุฒ ุดูู ูุงุนุฏุฉ ุงูุจูุงูุงุชุ ูุนุฑู ุงูููุงุณ ุงููู ุจููุซู ุงูุฑููุฑุด ุชูููุ ููุนูู API ูุชุฌุฏูุฏ ุงูุชูููุงุช.

ูู ูุจุฏุฃุ๐ฅ
